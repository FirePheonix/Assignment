{% extends 'website/base.html' %}
{% load static %}
{% block title %}Delete Account - Confirm{% endblock %}
{% block content %}
    <div class="min-h-screen bg-gray-50">
        <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Back Button -->
            <div class="mb-6">
                <a href="{% url 'website:account_deletion_preview' %}"
                   class="inline-flex items-center text-gray-600 hover:text-gray-900 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Preview
                </a>
            </div>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Confirm Account Deletion</h1>
                            <p class="text-gray-600 mt-1">This is your final chance to cancel</p>
                        </div>
                    </div>
                </div>
                <!-- Display Messages -->
                {% if messages %}
                    <div class="px-6 pt-4">
                        {% for message in messages %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-circle text-red-600 mt-1 mr-3"></i>
                                    <p class="text-sm text-red-700">{{ message }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                <form method="post" class="p-6">
                    {% csrf_token %}
                    <!-- Final Warning -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                        <div class="flex items-start">
                            <i class="fas fa-skull-crossbones text-red-600 mt-1 mr-3"></i>
                            <div>
                                <h3 class="text-sm font-semibold text-red-900">FINAL WARNING</h3>
                                <p class="text-sm text-red-700 mt-1">
                                    This action will PERMANENTLY delete your account and ALL associated data.
                                    There is absolutely no way to recover your account after this action is completed.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- Password Verification -->
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                            Enter your password to confirm deletion
                        </label>
                        <input type="password"
                               name="password"
                               id="password"
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                               placeholder="Your current password">
                        <p class="text-xs text-gray-500 mt-1">We need to verify your identity before proceeding</p>
                    </div>
                    <!-- Reason for Deletion (Optional) -->
                    <div class="mb-6">
                        <label for="reason" class="block text-sm font-medium text-gray-700 mb-2">
                            Why are you deleting your account? (Optional)
                        </label>
                        <select name="reason"
                                id="reason"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            <option value="">Choose a reason...</option>
                            <option value="not_using" {% if reason == "not_using" %}selected{% endif %}>I'm not using the service anymore</option>
                            <option value="found_alternative"
                                    {% if reason == "found_alternative" %}selected{% endif %}>
                                I found a better alternative
                            </option>
                            <option value="privacy_concerns"
                                    {% if reason == "privacy_concerns" %}selected{% endif %}>Privacy concerns</option>
                            <option value="too_complex"
                                    {% if reason == "too_complex" %}selected{% endif %}>Too complex to use</option>
                            <option value="missing_features"
                                    {% if reason == "missing_features" %}selected{% endif %}>
                                Missing features I need
                            </option>
                            <option value="cost" {% if reason == "cost" %}selected{% endif %}>Cost/pricing issues</option>
                            <option value="technical_issues"
                                    {% if reason == "technical_issues" %}selected{% endif %}>Technical issues</option>
                            <option value="other" {% if reason == "other" %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    <!-- Feedback (Optional) -->
                    <div class="mb-6">
                        <label for="feedback" class="block text-sm font-medium text-gray-700 mb-2">
                            Any feedback to help us improve? (Optional)
                        </label>
                        <textarea name="feedback"
                                  id="feedback"
                                  rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                  placeholder="Tell us what we could have done better...">{{ feedback }}</textarea>
                    </div>
                    <!-- Confirmation Checkbox -->
                    <div class="mb-6">
                        <label class="flex items-start">
                            <input type="checkbox"
                                   name="confirm_deletion"
                                   id="confirm_deletion"
                                   required
                                   class="mt-1 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                            <span class="ml-3 text-sm text-gray-700">
                                I understand that this action cannot be undone and will permanently delete my account and all associated data.
                            </span>
                        </label>
                    </div>
                    <!-- Action Buttons -->
                    <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                        <a href="{% url 'website:account_deletion_preview' %}"
                           class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Back to Preview
                        </a>
                        <button type="submit"
                                id="delete-button"
                                class="inline-flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-trash mr-2"></i>
                            <span id="button-text">DELETE MY ACCOUNT PERMANENTLY</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const submitButton = document.getElementById('delete-button');
    const buttonText = document.getElementById('button-text');
    
    form.addEventListener('submit', function(e) {
        // Add extra confirmation
        const confirmed = confirm(
            'Are you absolutely sure you want to delete your account?\n\n' +
            'This action cannot be undone and will permanently delete:\n' +
            '• Your profile and all personal information\n' +
            '• All your brands and associated data\n' +
            '• All conversations and messages\n' +
            '• All uploaded images and files\n\n' +
            'Type "DELETE" to confirm:'
        );
        
        if (!confirmed) {
            e.preventDefault();
            return false;
        }
        
        const finalConfirm = prompt('Type "DELETE" in capital letters to confirm:');
        if (finalConfirm !== 'DELETE') {
            e.preventDefault();
            alert('Deletion cancelled. You must type "DELETE" exactly to confirm.');
            return false;
        }
        
        // Disable button and show loading state
        submitButton.disabled = true;
        buttonText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Deleting Account...';
        
        return true;
    });
    
    // Enable/disable submit button based on form validity
    function checkFormValidity() {
        const password = document.getElementById('password').value;
        const confirmation = document.getElementById('confirm_deletion').checked;
        
        submitButton.disabled = !password || !confirmation;
    }
    
    document.getElementById('password').addEventListener('input', checkFormValidity);
    document.getElementById('confirm_deletion').addEventListener('change', checkFormValidity);
    
    // Initial check
    checkFormValidity();
});
    </script>
{% endblock %}
