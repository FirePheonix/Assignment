(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4191],{19377:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var r=a(12115),s=a(84335),n=a(18720);function o(){let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),d=(0,r.useCallback)(async()=>{try{o(!0);let e=await s.v.getBrands();t(e);let a=e.find(e=>e.is_default);c(a||null)}catch(e){console.error("Failed to fetch brands:",e),n.oR.error("Failed to fetch brands")}finally{o(!1)}},[]),l=(0,r.useCallback)(async a=>{try{let r=await s.v.createBrand(a);return t(e=>[...e,r]),0===e.length&&c(r),n.oR.success("Brand created successfully"),r}catch(e){throw console.error("Failed to create brand:",e),n.oR.error(e.message||"Failed to create brand"),e}},[e.length]),m=(0,r.useCallback)(async(e,a)=>{try{let r=await s.v.updateBrand(e,a);return t(t=>t.map(t=>t.id===e?r:t)),(null==i?void 0:i.id)===e&&c(r),n.oR.success("Brand updated successfully"),r}catch(e){throw console.error("Failed to update brand:",e),n.oR.error(e.message||"Failed to update brand"),e}},[null==i?void 0:i.id]),u=(0,r.useCallback)(async a=>{try{await s.v.setDefaultBrand(a),t(e=>e.map(e=>({...e,is_default:e.id===a})));let r=e.find(e=>e.id===a);c(r||null),n.oR.success("Default brand updated")}catch(e){console.error("Failed to set default brand:",e),n.oR.error(e.message||"Failed to set default brand")}},[e]);return(0,r.useEffect)(()=>{d()},[d]),{brands:e,defaultBrand:i,isLoading:a,createBrand:l,updateBrand:m,setDefault:u,refetch:d}}},38486:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(95155),s=a(89559),n=a(67161),o=a(42529),i=a(78874),c=a(12115),d=a(19377),l=a(70579),m=a(52619),u=a.n(m),h=a(18720);function p(){let{brands:e,isLoading:t}=(0,d.E)(),[a,m]=(0,c.useState)([]),[p,g]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{e.length&&m(await Promise.all(e.map(async e=>{try{let t=await l.X.getOAuthStatus(e.id);return{...e,instagram_connected:t.connected,instagram_username:t.instagram_username,instagram_user_id:t.instagram_user_id,connected_at:t.connected_at}}catch(t){return{...e,instagram_connected:!1}}})))})()},[e]);let x=async e=>{m(t=>t.map(t=>t.id===e?{...t,isConnecting:!0}:t));try{localStorage.setItem("instagram_connecting_brand_id",e.toString());let{oauth_url:t}=await l.X.startOAuth(e),a=window.open(t,"instagram_oauth","width=600,height=700");if(!a)return void h.oR.error("Please allow popups to connect Instagram");let r=setInterval(()=>{a.closed&&(clearInterval(r),m(t=>t.map(t=>t.id===e?{...t,isConnecting:!1}:t)),setTimeout(()=>f(e),1e3))},1e3)}catch(t){h.oR.error(t.message||"Failed to start Instagram authentication"),m(t=>t.map(t=>t.id===e?{...t,isConnecting:!1}:t))}},b=async e=>{if(confirm("Are you sure you want to disconnect this Instagram account?"))try{await l.X.disconnect(e),h.oR.success("Instagram account disconnected"),f(e)}catch(e){h.oR.error(e.message||"Failed to disconnect Instagram account")}},f=async e=>{try{let t=await l.X.getOAuthStatus(e);m(a=>a.map(a=>a.id===e?{...a,instagram_connected:t.connected,instagram_username:t.instagram_username,instagram_user_id:t.instagram_user_id,connected_at:t.connected_at}:a))}catch(e){console.error("Failed to refresh brand status:",e)}},w=async()=>{g(!0),await Promise.all(a.map(e=>f(e.id))),g(!1),h.oR.success("Instagram statuses refreshed")},y=a.reduce((e,t)=>{let a=t.organization_name||"Personal";return e[a]||(e[a]=[]),e[a].push(t),e},{}),j=a.filter(e=>e.instagram_connected).length;return(0,r.jsxs)("div",{className:"p-8 bg-black min-h-screen",children:[(0,r.jsx)("div",{className:"background-pattern-blue"}),(0,r.jsxs)("div",{className:"mb-8 relative z-10",children:[(0,r.jsxs)("nav",{className:"text-sm text-gray-400 mb-2",children:[(0,r.jsx)(u(),{href:"/dashboard",className:"hover:text-white transition-colors",children:"Dashboard"}),(0,r.jsx)("span",{className:"mx-2",children:"→"}),(0,r.jsx)("span",{className:"text-purple-400",children:"Instagram Connect"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Instagram Connections"}),(0,r.jsxs)("p",{className:"text-gray-400",children:[j," of ",a.length," brands connected"]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("button",{onClick:w,disabled:p,className:"bg-white/5 border border-white/10 hover:bg-white/10 text-white py-2 px-4 rounded-lg transition-colors flex items-center gap-2",children:[(0,r.jsx)(s.A,{className:"w-4 h-4 ".concat(p?"animate-spin":"")}),"Refresh"]}),(0,r.jsx)(u(),{href:"/dashboard/instagram/queue",className:"bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-colors",children:"View Queue"})]})]})]}),t?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-400",children:"Loading brands..."})]}):0===a.length?(0,r.jsxs)("div",{className:"bg-[#1a1a1a] border border-white/10 rounded-xl p-12 text-center",children:[(0,r.jsx)(n.A,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"No Brands Yet"}),(0,r.jsx)("p",{className:"text-gray-400 mb-6",children:"Create a brand first to connect Instagram"}),(0,r.jsx)(u(),{href:"/dashboard/brands",className:"bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition inline-flex items-center gap-2",children:"Create Brand"})]}):(0,r.jsx)("div",{className:"space-y-6",children:Object.entries(y).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"bg-[#1a1a1a] border border-white/10 rounded-xl p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:["Personal"===t?"\uD83D\uDC64":"\uD83C\uDFE2"," ",t,(0,r.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",a.filter(e=>e.instagram_connected).length,"/",a.length," connected)"]})]}),(0,r.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,r.jsx)("div",{className:"bg-black border border-white/10 rounded-lg p-4 hover:border-purple-500/30 transition",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-lg font-bold flex-shrink-0",children:e.name.substring(0,2).toUpperCase()}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-white font-medium",children:e.name}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-400 truncate",children:e.description})]}),e.instagram_connected?(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-400 text-sm font-medium",children:[(0,r.jsx)(o.A,{className:"w-4 h-4"}),"Connected"]}),e.instagram_username&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["@",e.instagram_username]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u(),{href:"/dashboard/brands/".concat(e.slug,"/instagram"),className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm transition",children:"Manage"}),(0,r.jsx)("button",{onClick:()=>b(e.id),className:"bg-red-600/20 hover:bg-red-600/30 text-red-400 px-3 py-2 rounded-lg text-sm transition border border-red-600/30",children:"Disconnect"})]})]}):(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,r.jsx)(i.A,{className:"w-4 h-4"}),"Not Connected"]}),(0,r.jsx)("button",{onClick:()=>x(e.id),disabled:e.isConnecting,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:opacity-90 disabled:opacity-50 text-white px-4 py-2 rounded-lg text-sm transition flex items-center gap-2",children:e.isConnecting?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Connecting..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{className:"w-4 h-4"}),"Connect"]})})]})]})},e.id))})]},t)})}),(0,r.jsxs)("div",{className:"bg-[#1a1a1a] border border-white/10 rounded-xl p-6 mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Requirements"}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm text-gray-400",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-purple-400",children:"•"}),(0,r.jsxs)("span",{children:["Your Instagram account must be a ",(0,r.jsx)("strong",{className:"text-white",children:"Business"})," or ",(0,r.jsx)("strong",{className:"text-white",children:"Creator"})," account"]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-purple-400",children:"•"}),(0,r.jsxs)("span",{children:["Instagram must be linked to a ",(0,r.jsx)("strong",{className:"text-white",children:"Facebook Page"})]})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-purple-400",children:"•"}),(0,r.jsx)("span",{children:"You need admin access to the Facebook Page"})]})]})]})]})}},42529:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},51551:(e,t,a)=>{Promise.resolve().then(a.bind(a,38486))},67161:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]])},70579:(e,t,a)=>{"use strict";a.d(t,{X:()=>d});let r="http://127.0.0.1:8000";function s(){let e=localStorage.getItem("auth_token");return console.log("Auth token available:",!!e),e}function n(){if("undefined"==typeof document)return null;let e="csrftoken";for(let t of document.cookie.split(";"))if((t=t.trim()).startsWith(e+"="))return decodeURIComponent(t.substring(e.length+1));return null}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s(),r=n(),o={"Content-Type":"application/json",...a&&{Authorization:"Token ".concat(a)},...r&&{"X-CSRFToken":r},...t.headers};return await fetch(e,{...t,headers:o})}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s(),r=n(),o={...a&&{Authorization:"Token ".concat(a)},...r&&{"X-CSRFToken":r},...t.headers};return await fetch(e,{...t,headers:o})}class c{async getOAuthStatus(e){if(!e)throw Error("Brand ID is required");let t="?brand_id=".concat(e);console.log("Making request to: ".concat(r,"/api/instagram/oauth-status/").concat(t));let a=await o("".concat(r,"/api/instagram/oauth-status/").concat(t));if(console.log("Instagram OAuth status response: ".concat(a.status," ").concat(a.statusText)),!a.ok){let e="Failed to get Instagram OAuth status";try{let t=await a.json();e=t.error||e,console.error("Instagram OAuth status error:",t)}catch(e){console.error("Failed to parse error response:",e)}if(401===a.status)throw Error("Authentication required. Please login again.");if(403===a.status)throw Error("Not authorized to access this brand.");if(404===a.status)throw Error("Brand not found.");throw Error(e)}let s=await a.json();return console.log("Instagram OAuth status data:",s),s}async startOAuth(e){let t=new URLSearchParams({brand_id:e.toString()});return{oauth_url:"".concat(r,"/api/instagram/oauth-start/?").concat(t)}}async disconnect(e){if(!(await o("".concat(r,"/api/instagram/oauth-disconnect/"),{method:"POST",body:JSON.stringify({brand_id:e})})).ok)throw Error("Failed to disconnect Instagram")}async getPosts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,s=new URLSearchParams({page:t.toString(),page_size:a.toString()});e&&s.append("brand_id",e.toString());let n=await o("".concat(r,"/api/instagram/brand-posts/?").concat(s));if(!n.ok)throw Error("Failed to get Instagram posts");return n.json()}async createPost(e){let t=new FormData;t.append("content",e.caption),t.append("brand_id",e.brand_id.toString()),e.image?t.append("image",e.image):e.imageUrl&&t.append("image_url",e.imageUrl),e.scheduled_time&&(t.append("scheduled_for",e.scheduled_time),t.append("status","approved"));let a=await i("".concat(r,"/api/instagram/brand-posts/"),{method:"POST",body:t});if(!a.ok)throw Error((await a.json()).error||"Failed to create Instagram post");return a.json()}async updatePost(e,t){let a=new FormData;t.caption&&a.append("content",t.caption),t.image&&a.append("image",t.image),t.imageUrl&&a.append("image_url",t.imageUrl),t.scheduled_time&&(a.append("scheduled_for",t.scheduled_time),a.append("status","approved"));let s=await i("".concat(r,"/api/instagram/brand-posts/").concat(e,"/"),{method:"PUT",body:a});if(!s.ok)throw Error("Failed to update Instagram post");return s.json()}async deletePost(e){if(!(await o("".concat(r,"/api/instagram/brand-posts/").concat(e,"/"),{method:"DELETE"})).ok)throw Error("Failed to delete Instagram post")}async postNow(e){let t=await o("".concat(r,"/api/instagram/brand-posts/").concat(e,"/post-now/"),{method:"POST"});if(!t.ok)throw Error((await t.json()).error||"Failed to post Instagram content");return t.json()}async generateContent(e,t){let a=await o("".concat(r,"/api/instagram/generate-content/"),{method:"POST",body:JSON.stringify({prompt:e,brand_id:t})});if(!a.ok)throw Error("Failed to generate Instagram content");return a.json()}async uploadImage(e){let t=new FormData;t.append("image",e);let a=await i("".concat(r,"/api/users/upload-instagram-image/"),{method:"POST",body:t});if(!a.ok)throw Error("Failed to upload image");return a.json()}async getUserUploads(){let e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization="Token ".concat(e));let a=await fetch("/api/users/my-uploads?format=instagram",{headers:t});if(!a.ok)throw Error("Failed to get user uploads");return a.json()}async deleteUserUpload(e){if(!(await o("".concat(r,"/api/users/my-uploads/").concat(e,"/"),{method:"DELETE"})).ok)throw Error("Failed to delete image")}}let d=new c},78874:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},84335:(e,t,a)=>{"use strict";a.d(t,{v:()=>o});let r="http://127.0.0.1:8000";async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem("auth_token"),r=function(){if("undefined"==typeof document)return null;let e="csrftoken";for(let t of document.cookie.split(";"))if((t=t.trim()).startsWith(e+"="))return decodeURIComponent(t.substring(e.length+1));return null}(),s={"Content-Type":"application/json",...a&&{Authorization:"Token ".concat(a)},...r&&{"X-CSRFToken":r},...t.headers};return await fetch(e,{...t,headers:s,credentials:"include"})}class n{async getBrands(){let e=await s("".concat(r,"/api/brands/"));if(!e.ok)throw Error("Failed to fetch brands");return e.json()}async createBrand(e){let t=await s("".concat(r,"/api/brands/create/"),{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create brand");return t.json()}async updateBrand(e,t){let a=await s("".concat(r,"/api/brands/").concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).error||"Failed to update brand");return a.json()}async setDefaultBrand(e){let t=await s("".concat(r,"/api/brands/").concat(e,"/set-default/"),{method:"POST"});if(!t.ok)throw Error((await t.json()).error||"Failed to set default brand")}async deleteBrand(e){let t=await s("".concat(r,"/api/brands/").concat(e,"/delete/"),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete brand")}}let o=new n},89559:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[297,8720,8441,1255,7358],()=>e(e.s=51551)),_N_E=e.O()}]);