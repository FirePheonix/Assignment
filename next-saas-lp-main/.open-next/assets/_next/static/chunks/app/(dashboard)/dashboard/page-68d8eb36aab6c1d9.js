(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6337],{30080:(e,t,a)=>{"use strict";a.d(t,{k:()=>i,r:()=>c});let s="http://127.0.0.1:8000";function l(){return localStorage.getItem("auth_token")}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=l(),s={"Content-Type":"application/json",...a&&{Authorization:"Token ".concat(a)},...t.headers};return await fetch(e,{...t,headers:s})}let i={async list(){let e=await r("".concat(s,"/api/workspaces/"));if(!e.ok)throw Error((await e.json().catch(()=>({detail:"Failed to list workspaces"}))).detail||"Failed to list workspaces");return(await e.json()).workspaces.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))},async get(e){let t=await r("".concat(s,"/api/workspaces/").concat(e,"/"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get workspace"}))).detail||"Failed to get workspace");let a=await t.json();return{...a.workspace,createdAt:new Date(a.workspace.createdAt),updatedAt:new Date(a.workspace.updatedAt)}},async create(e){let t=await r("".concat(s,"/api/workspaces/"),{method:"POST",body:JSON.stringify({name:e,content:{nodes:[],edges:[]}})});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to create workspace"}))).detail||"Failed to create workspace");let a=await t.json();return{...a.workspace,createdAt:new Date(a.workspace.createdAt),updatedAt:new Date(a.workspace.updatedAt)}},async save(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/"),{method:"PATCH",body:JSON.stringify({content:t})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to save workspace"}))).detail||"Failed to save workspace");let l=await a.json();return{...l.workspace,createdAt:new Date(l.workspace.createdAt),updatedAt:new Date(l.workspace.updatedAt)}},async rename(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/"),{method:"PATCH",body:JSON.stringify({name:t})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to rename workspace"}))).detail||"Failed to rename workspace");let l=await a.json();return{...l.workspace,createdAt:new Date(l.workspace.createdAt),updatedAt:new Date(l.workspace.updatedAt)}},async delete(e){let t=await r("".concat(s,"/api/workspaces/").concat(e,"/"),{method:"DELETE"});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to delete workspace"}))).detail||"Failed to delete workspace")},async duplicate(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/duplicate/"),{method:"POST",body:JSON.stringify({name:t})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to duplicate workspace"}))).detail||"Failed to duplicate workspace");let l=await a.json();return{...l.workspace,createdAt:new Date(l.workspace.createdAt),updatedAt:new Date(l.workspace.updatedAt)}},async getBySlug(e){let t=await r("".concat(s,"/api/workspaces/slug/").concat(e,"/"));if(!t.ok){let e=await t.json().catch(()=>({detail:"Workspace not found"}));throw Error(e.detail||e.error||"Workspace not found")}let a=await t.json();return{...a.workspace,createdAt:new Date(a.workspace.createdAt),updatedAt:new Date(a.workspace.updatedAt),publishedAt:a.workspace.publishedAt?new Date(a.workspace.publishedAt):void 0,media:(a.workspace.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}},async publish(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/publish/"),{method:"POST",body:JSON.stringify({description:t})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to publish workspace"}))).detail||"Failed to publish workspace");let l=await a.json();return{...l.workspace,createdAt:new Date(l.workspace.createdAt),updatedAt:new Date(l.workspace.updatedAt),publishedAt:l.workspace.publishedAt?new Date(l.workspace.publishedAt):void 0,media:(l.workspace.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}},async unpublish(e){let t=await r("".concat(s,"/api/workspaces/").concat(e,"/unpublish/"),{method:"POST"});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to unpublish workspace"}))).detail||"Failed to unpublish workspace");let a=await t.json();return{...a.workspace,createdAt:new Date(a.workspace.createdAt),updatedAt:new Date(a.workspace.updatedAt),publishedAt:a.workspace.publishedAt?new Date(a.workspace.publishedAt):void 0,media:(a.workspace.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}},async uploadMedia(e,t,a,r,i){let c=new FormData;c.append("file",t),c.append("mediaType",a),r&&c.append("title",r),i&&c.append("thumbnail",i);let o=l(),n=await fetch("".concat(s,"/api/workspaces/").concat(e,"/upload_media/"),{method:"POST",headers:{...o&&{Authorization:"Token ".concat(o)}},body:c});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Failed to upload media"}))).detail||"Failed to upload media");let d=await n.json();return{...d.media,createdAt:new Date(d.media.createdAt)}},async deleteMedia(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/media/").concat(t,"/"),{method:"DELETE"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to delete media"}))).detail||"Failed to delete media")},async importWorkspace(e,t){let a=await r("".concat(s,"/api/workspaces/").concat(e,"/import_workspace/"),{method:"POST",body:JSON.stringify({name:t})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to import workspace"}))).detail||"Failed to import workspace");let l=await a.json();return{...l.workspace,createdAt:new Date(l.workspace.createdAt),updatedAt:new Date(l.workspace.updatedAt),publishedAt:l.workspace.publishedAt?new Date(l.workspace.publishedAt):void 0,media:(l.workspace.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}}},c={async list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"recent",t=arguments.length>1?arguments[1]:void 0,a=new URLSearchParams({sort:e});t&&a.append("search",t);let l=await fetch("".concat(s,"/api/public-workspaces/?").concat(a));if(!l.ok)throw Error((await l.json().catch(()=>({detail:"Failed to load feed"}))).detail||"Failed to load feed");return(await l.json()).workspaces.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),publishedAt:e.publishedAt?new Date(e.publishedAt):void 0,media:(e.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}))},async getBySlug(e){let t=await fetch("".concat(s,"/api/public-workspaces/").concat(e,"/"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Workspace not found"}))).detail||"Workspace not found");let a=await t.json();return{...a.workspace,createdAt:new Date(a.workspace.createdAt),updatedAt:new Date(a.workspace.updatedAt),publishedAt:a.workspace.publishedAt?new Date(a.workspace.publishedAt):void 0,media:(a.workspace.media||[]).map(e=>({...e,createdAt:new Date(e.createdAt)}))}}}},59301:(e,t,a)=>{Promise.resolve().then(a.bind(a,68071))},68071:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(95155),l=a(12115),r=a(50906),i=a(80534),c=a(91169),o=a(1524),n=a(65229),d=a(42196),u=a(60890),m=a(92001),p=a(80003),h=a(15530),w=a(66955),x=a(85710),g=a(86651),f=a(59847),b=a(85921),j=a(57828),v=a(37772),k=a(18720),y=a(30080);function N(e){var t,a;try{return(null==(t=new URL(e).pathname.split(".").pop())?void 0:t.toLowerCase())||null}catch(s){let t=e.split(".");return t.length>1&&(null==(a=t.pop())?void 0:a.toLowerCase())||null}}function A(e){if(!e||"string"!=typeof e)return!1;let t=N(e);return!!t&&["jpg","jpeg","png","gif","bmp","webp","svg","tiff","ico","mp4","avi","mov","wmv","flv","webm","mkv","m4v","3gp","mp3","wav","ogg","flac","aac","m4a","wma"].includes(t)}var S=a(12932),C=a(62332),D=a(39867),_=a(93499),T=a(97624),E=a(37354),F=a(53511),U=a(2068),M=a(35130);function L(e){var t,a;let{media:r,onClose:i,allMedia:c=[],currentIndex:o=0,onNavigate:d}=e,[u,m]=(0,l.useState)(!1),[p,h]=(0,l.useState)(!1),[w,x]=(0,l.useState)(1),[g,f]=(0,l.useState)(0),[j,v]=(0,l.useState)(0),[k,y]=(0,l.useState)(!1),[N,A]=(0,l.useState)(!1),L=(0,l.useRef)(null),P=(0,l.useRef)(null),O=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{if(r)switch(e.key){case"Escape":i();break;case"ArrowLeft":c.length>1&&o>0&&(null==d||d(o-1));break;case"ArrowRight":c.length>1&&o<c.length-1&&(null==d||d(o+1));break;case" ":e.preventDefault(),"video"===r.mediaType&&L.current&&R()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r,o,c.length,d,i]),(0,l.useEffect)(()=>{m(!1),f(0),v(0),A(!1)},[r]);let R=()=>{(null==r?void 0:r.mediaType)==="video"&&L.current&&(u?L.current.pause():L.current.play(),m(!u))},W=()=>{L.current&&(L.current.muted=!p,h(!p)),P.current&&(P.current.muted=!p,h(!p))},z=e=>{let t=e.currentTarget;f(t.currentTime),v(t.duration)},I=e=>{L.current&&(L.current.currentTime=e),P.current&&(P.current.currentTime=e),f(e)},J=e=>{let t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t,":").concat(a.toString().padStart(2,"0"))};return r?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",children:[(0,s.jsxs)("div",{ref:O,className:"relative max-w-full max-h-full ".concat(k?"w-full h-full":"w-fit h-fit"," flex flex-col"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-black/50 text-white",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"text-lg font-medium truncate",children:r.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-300 truncate",children:[r.workspace_name," • ",null==(t=r.format)?void 0:t.toUpperCase()," • ",r.mediaType]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[c.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>null==d?void 0:d(o-1),disabled:0===o,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous media",children:(0,s.jsx)(S.A,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm text-gray-300",children:[o+1," of ",c.length]}),(0,s.jsx)("button",{onClick:()=>null==d?void 0:d(o+1),disabled:o===c.length-1,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next media",children:(0,s.jsx)(C.A,{className:"w-4 h-4"})})]}),(0,s.jsx)("button",{onClick:()=>{if(!r)return;let e=document.createElement("a");e.href=r.url,e.download=r.original_filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",title:"Download",children:(0,s.jsx)(D.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>{r&&window.open(r.url,"_blank")},className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",title:"Open in new tab",children:(0,s.jsx)(_.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>y(!k),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",title:k?"Exit fullscreen":"Fullscreen",children:k?(0,s.jsx)(T.A,{className:"w-4 h-4"}):(0,s.jsx)(E.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:i,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",title:"Close",children:(0,s.jsx)(n.A,{className:"w-4 h-4"})})]})]}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center bg-black min-h-0",children:"image"===r.mediaType?(0,s.jsx)("div",{className:"relative max-w-full max-h-full flex items-center justify-center",children:N?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-gray-400",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDDBC️"}),(0,s.jsx)("p",{className:"text-lg",children:"Failed to load image"}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"The image file might be corrupted or unavailable"})]}):(0,s.jsx)("img",{src:r.url,alt:r.title,className:"max-w-full max-h-full object-contain ".concat(k?"w-full h-full":""),onError:()=>A(!0),onClick:e=>e.stopPropagation()})}):"video"===r.mediaType?(0,s.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("video",{ref:L,src:r.url,className:"max-w-full max-h-full ".concat(k?"w-full h-full":""),onTimeUpdate:z,onPlay:()=>m(!0),onPause:()=>m(!1),onLoadedMetadata:z,controls:!1,onClick:R})}),(0,s.jsx)("div",{className:"bg-black/50 p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:R,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",children:u?(0,s.jsx)(F.A,{className:"w-5 h-5"}):(0,s.jsx)(b.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:W,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",children:p?(0,s.jsx)(U.A,{className:"w-5 h-5"}):(0,s.jsx)(M.A,{className:"w-5 h-5"})}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:w,onChange:e=>{var t;x(t=parseFloat(e.target.value)),L.current&&(L.current.volume=t),P.current&&(P.current.volume=t)},className:"w-20"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{type:"range",min:"0",max:j||0,value:g,onChange:e=>I(parseFloat(e.target.value)),className:"w-full"})}),(0,s.jsxs)("span",{className:"text-white text-sm min-w-[80px]",children:[J(g)," / ",J(j)]})]})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-white",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:r.format&&["mp3","wav","ogg","flac","aac","m4a"].includes(r.format)?"\uD83C\uDFB5":"\uD83D\uDCC1"}),(0,s.jsx)("h3",{className:"text-xl font-medium mb-2",children:r.title}),(0,s.jsxs)("p",{className:"text-gray-400 mb-4",children:[null==(a=r.format)?void 0:a.toUpperCase()," file"]}),r.format&&["mp3","wav","ogg","flac","aac","m4a"].includes(r.format)&&(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsx)("audio",{ref:P,src:r.url,onTimeUpdate:z,onPlay:()=>m(!0),onPause:()=>m(!1),onLoadedMetadata:z,className:"hidden"}),(0,s.jsx)("div",{className:"bg-white/10 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>{P.current&&(u?P.current.pause():P.current.play())},className:"p-3 rounded-full bg-purple-500 hover:bg-purple-600",children:u?(0,s.jsx)(F.A,{className:"w-6 h-6"}):(0,s.jsx)(b.A,{className:"w-6 h-6"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("input",{type:"range",min:"0",max:j||0,value:g,onChange:e=>I(parseFloat(e.target.value)),className:"w-full"}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mt-1",children:[(0,s.jsx)("span",{children:J(g)}),(0,s.jsx)("span",{children:J(j)})]})]}),(0,s.jsx)("button",{onClick:W,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20",children:p?(0,s.jsx)(U.A,{className:"w-5 h-5"}):(0,s.jsx)(M.A,{className:"w-5 h-5"})})]})})]})]})})]}),(0,s.jsx)("div",{className:"absolute inset-0 -z-10",onClick:i})]}):null}function P(e){let{onMediaSelect:t,selectedMedia:a,className:r="",showUpload:i=!0,maxSelection:c=1}=e,{allMedia:o,isLoading:n,workspaces:d,formatFilter:u,setFormatFilter:m,workspaceFilter:b,setWorkspaceFilter:j,searchTerm:v,setSearchTerm:S,refetch:C,getMediaStats:D,getUniqueWorkspaces:_}=function(){let[e,t]=(0,l.useState)([]),[a,s]=(0,l.useState)([]),[r,i]=(0,l.useState)(!0),[c,o]=(0,l.useState)([]),[n,d]=(0,l.useState)("all"),[u,m]=(0,l.useState)("all"),[p,h]=(0,l.useState)("all"),[w,x]=(0,l.useState)(""),g=(0,l.useCallback)(async()=>{try{i(!0);let e=await y.k.list();console.log("Loaded workspaces:",e),o(e);let a=[];for(let t of e){console.log("Processing workspace: ".concat(t.name));try{let e=await y.k.get(t.id);console.log("Detailed workspace ".concat(t.name,":"),e.media),e.media&&e.media.length>0&&e.media.forEach(e=>{console.log("Processing media:",e);try{let s={id:"".concat(t.id,"-").concat(e.id),url:e.fileUrl,thumbnail_url:e.thumbnailUrl||e.fileUrl,original_filename:e.title||"media_".concat(e.id),format:N(e.fileUrl)||("image"===e.mediaType?"jpg":"mp4"),width:void 0,height:void 0,file_size:void 0,purpose:"workspace_content",usage_count:1,created_at:e.createdAt instanceof Date?e.createdAt.toISOString():"string"==typeof e.createdAt?e.createdAt:new Date().toISOString(),storage_type:"workspace",public_id:e.id,workspace_name:t.name,workspace_id:t.id,mediaType:e.mediaType,title:e.title};a.push(s)}catch(t){console.error("Error processing media item:",e,t)}}),e.content&&e.content.nodes&&(console.log("Checking nodes in ".concat(t.name,":"),e.content.nodes),e.content.nodes.forEach((s,l)=>{try{let r=s.data||{},i=[];r.imageUrl&&i.push(r.imageUrl),r.videoUrl&&i.push(r.videoUrl),r.audioUrl&&i.push(r.audioUrl),r.mediaUrl&&i.push(r.mediaUrl),r.url&&A(r.url)&&i.push(r.url),r.src&&A(r.src)&&i.push(r.src),r.fileUrl&&A(r.fileUrl)&&i.push(r.fileUrl);let c=function e(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!t||"object"!=typeof t||a.has(t))return[];a.add(t);let s=[];for(let[l,r]of Object.entries(t))"string"==typeof r&&A(r)?s.push(r):"object"==typeof r&&null!==r&&s.push(...e(r,a));return s}(r);i=i.concat(c),(i=[...new Set(i)]).forEach((s,i)=>{if(s&&A(s)){console.log("Found media URL in node: ".concat(s));let c=function(e){var t;let a=null==(t=N(e))?void 0:t.toLowerCase();return a&&["jpg","jpeg","png","gif","bmp","webp","svg","tiff","ico"].includes(a)?"image":a&&["mp4","avi","mov","wmv","flv","webm","mkv","m4v","3gp"].includes(a)?"video":"image"}(s),o=function(e){try{return new URL(e).pathname.split("/").pop()||"unknown_file"}catch(t){return e.split("/").pop()||"unknown_file"}}(s),n={id:"".concat(t.id,"-node-").concat(l,"-").concat(i),url:s,thumbnail_url:"image"===c?s:void 0,original_filename:o,format:N(s)||"unknown",width:void 0,height:void 0,file_size:void 0,purpose:"node_content",usage_count:1,created_at:e.createdAt.toISOString(),storage_type:"workspace",public_id:"node-".concat(l,"-").concat(i),workspace_name:t.name,workspace_id:t.id,mediaType:c,title:r.label||r.title||o||"Untitled Media"};a.push(n)}})}catch(e){console.error("Error processing node:",s,e)}}))}catch(e){console.error("Error fetching detailed workspace ".concat(t.name,":"),e)}}return a.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),t(a),a.length>0?k.oR.success("Found ".concat(a.length," media items from ").concat(e.length," workspaces")):k.oR.info("No media found in your workspaces"),a}catch(e){return console.error("Failed to fetch workspace media:",e),k.oR.error("Failed to load workspace media: "+(e.message||"Unknown error")),t([]),[]}finally{i(!1)}},[]);(0,l.useEffect)(()=>{let t=[...e];if("all"!==u)switch(u){case"images":t=t.filter(e=>"image"===e.mediaType);break;case"videos":t=t.filter(e=>"video"===e.mediaType)}if("all"!==p&&(t=t.filter(e=>e.workspace_id===p)),w){let e=w.toLowerCase();t=t.filter(t=>t.original_filename.toLowerCase().includes(e)||t.title.toLowerCase().includes(e)||t.workspace_name&&t.workspace_name.toLowerCase().includes(e))}s(t)},[e,u,p,w]);let f=(0,l.useCallback)(async(e,t,a)=>{try{let s=e.type.startsWith("image/")?"image":"video";await y.k.uploadMedia(t,e,s,a),await g(),k.oR.success("Media uploaded successfully")}catch(e){throw console.error("Failed to upload media:",e),k.oR.error(e.message||"Failed to upload media"),e}},[g]),b=(0,l.useCallback)(async(e,a)=>{try{let s=e.split("-").pop()||e;await y.k.deleteMedia(a,s),t(t=>t.filter(t=>t.id!==e)),k.oR.success("Media deleted successfully")}catch(e){console.error("Failed to delete media:",e),k.oR.error(e.message||"Failed to delete media")}},[]),j=(0,l.useCallback)(()=>Array.from(new Set(e.map(e=>e.format.toLowerCase()))).sort(),[e]),v=(0,l.useCallback)(()=>c.map(e=>({id:e.id,name:e.name})),[c]),S=(0,l.useCallback)(()=>{let t={total:e.length,images:0,videos:0,workspaces:c.length};return e.forEach(e=>{"image"===e.mediaType?t.images++:"video"===e.mediaType&&t.videos++}),t},[e,c]);return(0,l.useEffect)(()=>{g()},[g]),{allMedia:a,isLoading:r,workspaces:c,useMockData:!1,formatFilter:u,setFormatFilter:m,workspaceFilter:p,setWorkspaceFilter:h,searchTerm:w,setSearchTerm:x,uploadMedia:f,deleteMedia:b,refetch:g,getUniqueFormats:j,getUniqueWorkspaces:v,getMediaStats:S}}(),[T,E]=(0,l.useState)("grid"),[F,U]=(0,l.useState)(!1),[M,P]=(0,l.useState)(new Set),[W,z]=(0,l.useState)(!1),[I,J]=(0,l.useState)(null),[B,H]=(0,l.useState)(0),V=D(),q=_(),K=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a)if(1===c)null==t||t(e);else{let a=new Set(M);if(a.has(e.id))a.delete(e.id);else{if(!(a.size<c))return void k.oR.error("Maximum ".concat(c," items can be selected"));a.add(e.id)}P(a),null==t||t(e)}else H(o.findIndex(t=>t.id===e.id)),J(e)};return n?(0,s.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-400"}),(0,s.jsx)("span",{className:"ml-3 text-gray-400",children:"Loading your workspace media..."})]}):(0,s.jsxs)("div",{className:"h-full flex flex-col ".concat(r),children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-4 p-4 border-b border-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white",children:"Workspace Media"}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:[V.total," items from ",V.workspaces," workspaces • ",V.images," images • ",V.videos," videos"]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>E("grid"===T?"list":"grid"),className:"p-2 bg-white/10 rounded-lg hover:bg-white/20 transition-colors",title:"Switch to ".concat("grid"===T?"list":"grid"," view"),children:"grid"===T?(0,s.jsx)(p.A,{className:"w-4 h-4"}):(0,s.jsx)(h.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>U(!F),className:"p-2 rounded-lg transition-colors ".concat(F?"bg-purple-500 text-white":"bg-white/10 hover:bg-white/20"),title:"Toggle filters",children:(0,s.jsx)(w.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:C,className:"p-2 bg-white/10 rounded-lg hover:bg-white/20 transition-colors",title:"Refresh media",children:(0,s.jsx)(x.A,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by filename, title, or workspace...",value:v,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-400"})]}),F&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-white/5 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Media Type"}),(0,s.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[(0,s.jsx)("option",{value:"all",children:"All Types"}),(0,s.jsx)("option",{value:"images",children:"Images"}),(0,s.jsx)("option",{value:"videos",children:"Videos"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Workspace"}),(0,s.jsxs)("select",{value:b,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[(0,s.jsx)("option",{value:"all",children:"All Workspaces"}),q.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-4",children:0===o.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[(0,s.jsx)(f.A,{className:"w-12 h-12 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No media found"}),(0,s.jsx)("p",{className:"text-sm text-center",children:v||"all"!==u||"all"!==b?"Try adjusting your filters or search terms":"No media files found in your workspaces"})]}):"grid"===T?(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:o.map(e=>(0,s.jsx)(O,{media:e,isSelected:M.has(e.id)||(null==a?void 0:a.id)===e.id,onClick:()=>K(e),onSelect:()=>K(e,!0),showSelection:!!t},e.id))}):(0,s.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,s.jsx)(R,{media:e,isSelected:M.has(e.id)||(null==a?void 0:a.id)===e.id,onClick:()=>K(e),onSelect:()=>K(e,!0),showSelection:!!t},e.id))})}),(0,s.jsx)(L,{media:I,onClose:()=>J(null),allMedia:o,currentIndex:B,onNavigate:e=>{e>=0&&e<o.length&&(H(e),J(o[e]))}})]})}function O(e){let{media:t,isSelected:a,onClick:r,onSelect:i,showSelection:c=!1}=e,[o,n]=(0,l.useState)(!1),d=W(t.format,t.mediaType);return(0,s.jsxs)("div",{onClick:r,className:"group relative bg-white/5 rounded-lg overflow-hidden cursor-pointer border-2 transition-all hover:bg-white/10 ".concat(a?"border-purple-400 bg-white/15":"border-transparent"),children:[(0,s.jsxs)("div",{className:"aspect-square relative overflow-hidden bg-gray-800",children:["image"!==t.mediaType||o?"video"===t.mediaType?(0,s.jsxs)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center relative",children:[(0,s.jsx)(b.A,{className:"w-8 h-8 text-white/60"}),t.thumbnail_url&&(0,s.jsx)("img",{src:t.thumbnail_url,alt:t.title,className:"absolute inset-0 w-full h-full object-cover",onError:()=>n(!0)})]}):(0,s.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:(0,s.jsx)(d,{className:"w-8 h-8 text-gray-400"})}):(0,s.jsx)("img",{src:t.thumbnail_url||t.url,alt:t.title,className:"w-full h-full object-cover",onError:()=>n(!0)}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,s.jsx)(j.A,{className:"w-6 h-6 text-white"})}),c&&a&&(0,s.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-purple-400 rounded-full flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),c&&!a&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),null==i||i()},className:"absolute top-2 right-2 w-5 h-5 bg-black/50 hover:bg-black/70 rounded-full flex items-center justify-center transition-colors opacity-0 group-hover:opacity-100",children:(0,s.jsx)("div",{className:"w-2 h-2 border border-white rounded-full"})}),(0,s.jsx)("div",{className:"absolute top-2 left-2 px-2 py-1 bg-black/60 rounded text-xs text-white font-medium",children:t.mediaType.toUpperCase()})]}),(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-white truncate",title:t.title,children:t.title}),(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate mt-1",title:t.workspace_name,children:t.workspace_name}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"uppercase",children:t.format}),(0,s.jsx)("span",{children:z(t.created_at).split(",")[0]})]})]})]})}function R(e){let{media:t,isSelected:a,onClick:r,onSelect:i,showSelection:c=!1}=e,[o,n]=(0,l.useState)(!1),d=W(t.format,t.mediaType);return(0,s.jsxs)("div",{onClick:r,className:"group flex items-center p-3 rounded-lg cursor-pointer border transition-colors hover:bg-white/5 ".concat(a?"border-purple-400 bg-white/10":"border-white/10"),children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded overflow-hidden bg-gray-800 flex-shrink-0",children:"image"!==t.mediaType||o?"video"===t.mediaType?(0,s.jsxs)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center relative",children:[(0,s.jsx)(b.A,{className:"w-4 h-4 text-white/60"}),t.thumbnail_url&&(0,s.jsx)("img",{src:t.thumbnail_url,alt:t.title,className:"absolute inset-0 w-full h-full object-cover",onError:()=>n(!0)})]}):(0,s.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:(0,s.jsx)(d,{className:"w-4 h-4 text-gray-400"})}):(0,s.jsx)("img",{src:t.thumbnail_url||t.url,alt:t.title,className:"w-full h-full object-cover",onError:()=>n(!0)})}),(0,s.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-white truncate",title:t.title,children:t.title}),(0,s.jsxs)("div",{className:"flex items-center space-x-3 text-xs text-gray-400 mt-1",children:[(0,s.jsx)("span",{children:t.workspace_name}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{className:"uppercase",children:t.format}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:t.mediaType})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-400",children:[(0,s.jsx)("span",{className:"hidden sm:block",children:z(t.created_at)}),c&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),null==i||i()},className:"p-2 rounded transition-all ".concat(a?"bg-purple-500 text-white":"bg-white/10 text-gray-400 hover:bg-white/20 opacity-0 group-hover:opacity-100"),children:a?"✓":"+"}),(0,s.jsx)("button",{className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-white/10 rounded transition-all",children:(0,s.jsx)(v.A,{className:"w-4 h-4"})})]})]})}function W(e,t){return"image"===t?d.A:"video"===t?u.A:m.A}function z(e){try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return"Unknown date"}}function I(){let[e,t]=(0,l.useState)(!1),[a,d]=(0,l.useState)(null),u=[{name:"Total Videos",value:"1,234",change:"+12%",icon:r.A},{name:"Views This Month",value:"45.2K",change:"+23%",icon:i.A},{name:"Active Projects",value:"8",change:"+2",icon:c.A},{name:"Engagement Rate",value:"68%",change:"+5%",icon:o.A}];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Dashboard"}),(0,s.jsx)("p",{className:"text-gray-400 mt-1",children:"Welcome back! Here's what's happening with your projects."})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:u.map(e=>{let t=e.icon;return(0,s.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-6 hover:bg-white/10 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("div",{className:"p-2 bg-white/10 rounded-lg",children:(0,s.jsx)(t,{className:"w-5 h-5 text-purple-400"})}),(0,s.jsx)("span",{className:"text-green-400 text-sm font-medium",children:e.change})]}),(0,s.jsx)("h3",{className:"text-2xl font-bold mb-1",children:e.value}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:e.name})]},e.name)})}),(0,s.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Your Media Feed"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"All your images, videos, and audio files from your workspaces"})]})}),(0,s.jsx)("div",{className:"min-h-96",children:(0,s.jsx)(P,{onMediaSelect:e=>{d(e)},selectedMedia:a,className:"h-full"})})]}),e&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80",children:(0,s.jsxs)("div",{className:"bg-[#0a0a0a] rounded-lg w-full max-w-7xl h-[90vh] overflow-hidden relative",children:[(0,s.jsx)("button",{onClick:()=>t(!1),className:"absolute top-4 right-4 z-10 p-2 bg-white/10 rounded-lg hover:bg-white/20 transition",children:(0,s.jsx)(n.A,{className:"w-5 h-5 text-white"})}),(0,s.jsx)(P,{onMediaSelect:e=>{d(e)},selectedMedia:a,className:"h-full overflow-hidden"})]})})]})}}},e=>{e.O(0,[8720,1492,8441,1255,7358],()=>e(e.s=59301)),_N_E=e.O()}]);