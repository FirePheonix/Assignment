(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9056],{18085:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},20063:(e,t,a)=>{"use strict";var r=a(47260);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},26869:(e,t,a)=>{Promise.resolve().then(a.bind(a,38007))},35299:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},37586:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},38007:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(95155),s=a(35299),n=a(96583),i=a(86651),l=a(71847);let c=(0,l.A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),o=(0,l.A)("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]);var u=a(18085),d=a(37586),h=a(12115),m=a(72011),x=a(47886),p=a(18720),f=a(20063);function g(){let e=(0,f.useRouter)(),t=(0,f.useSearchParams)(),[a,l]=(0,h.useState)(""),[g,y]=(0,h.useState)([]),[w,v]=(0,h.useState)(null),[b,j]=(0,h.useState)([]),[N,k]=(0,h.useState)(!0),[S,A]=(0,h.useState)(!1),[C,_]=(0,h.useState)(null),[P,E]=(0,h.useState)(""),R=(0,h.useRef)(null),q=(0,h.useRef)(null);(0,h.useEffect)(()=>{let e=t.get("conversation");e&&v(parseInt(e))},[t]),(0,h.useEffect)(()=>{M()},[]);let M=async()=>{try{k(!0);let e=await (0,x.HW)();e&&_(e.id);let t=await m.P.getConversations();y(t.chats),t.chats.length>0&&!w&&v(t.chats[0].id)}catch(e){p.oR.error("Failed to load conversations")}finally{k(!1)}};(0,h.useEffect)(()=>{if(w)return W(w),L(w),()=>{R.current&&(R.current.close(),R.current=null)}},[w]);let W=async e=>{try{let t=await m.P.getConversation(e);j(t.messages||[])}catch(e){p.oR.error("Failed to load messages")}},L=e=>{let t=m.P.createWebSocket(e);t&&(t.onmessage=e=>{let t=JSON.parse(e.data);if("chat_message"===t.type){let e={id:t.message_id,sender:{id:t.user_id,username:t.username},content:t.message,timestamp:t.timestamp,is_read:!1,image:t.image_url};j(t=>[...t,e]),M()}},R.current=t)},O=async()=>{if(!a.trim()||!w||S)return;let e=a.trim();l(""),A(!0);try{await m.P.sendMessage(w,e)}catch(t){p.oR.error("Failed to send"),l(e)}finally{A(!1)}},T=e=>C?e.participant1.id===C?e.participant2:e.participant1:e.participant2,z=e=>{if(e.brand)return e.brand.name;let t=T(e);return t.first_name&&t.last_name?"".concat(t.first_name," ").concat(t.last_name):t.username},F=g.find(e=>e.id===w);return N?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(s.A,{className:"w-8 h-8 animate-spin text-purple-500"})}):(0,r.jsxs)("div",{className:"h-screen bg-[#0a0a0a] flex overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-80 bg-[#121212] flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-white/5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h2",{className:"text-lg text-white font-semibold",children:"Messages"}),(0,r.jsx)("button",{onClick:()=>e.push("/dashboard/chat/new"),className:"p-1.5 hover:bg-white/10 rounded-lg",children:(0,r.jsx)(n.A,{className:"w-5 h-5 text-gray-400"})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(i.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),(0,r.jsx)("input",{value:P,onChange:e=>E(e.target.value),placeholder:"Search",className:"w-full bg-[#1a1a1a] text-white text-sm pl-9 pr-3 py-2 rounded-lg outline-none"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:g.filter(e=>z(e).toLowerCase().includes(P.toLowerCase())).map(e=>{var t;let a=T(e),s=z(e),n=e.id===w;return(0,r.jsx)("div",{onClick:()=>v(e.id),className:"p-3 border-b border-white/5 cursor-pointer hover:bg-white/5 ".concat(n?"bg-white/5":""),children:(0,r.jsxs)("div",{className:"flex gap-3 items-center",children:[a.profile_picture?(0,r.jsx)("img",{src:a.profile_picture,className:"w-12 h-12 rounded-full"}):(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex justify-center items-center text-white",children:s.substring(0,2).toUpperCase()}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-white text-sm font-medium truncate",children:s}),(0,r.jsx)("p",{className:"text-xs text-gray-400 truncate",children:(null==(t=e.last_message)?void 0:t.content)||"No messages yet"})]})]})},e.id)})})]}),F?(0,r.jsxs)("div",{className:"flex-1 flex flex-col bg-[#0a0a0a]",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-white/5 flex justify-between items-center bg-[#121212]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[T(F).profile_picture?(0,r.jsx)("img",{src:T(F).profile_picture,className:"w-10 h-10 rounded-full"}):(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex justify-center items-center text-white",children:z(F).substring(0,2).toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-white text-sm font-semibold",children:z(F)}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:F.brand?"Brand":"Creator"})]})]}),(0,r.jsx)("button",{className:"p-2 hover:bg-white/10 rounded-lg transition",children:(0,r.jsx)(c,{className:"w-4 h-4 text-gray-400"})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 space-y-4 py-4",children:[b.map((e,t)=>{let a=e.sender.id===C;return(0,r.jsx)("div",{className:"flex ".concat(a?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"max-w-md px-4 py-2 rounded-2xl ".concat(a?"bg-blue-600 text-white":"bg-[#1f1f1f] text-white"),children:e.content})},e.id)}),(0,r.jsx)("div",{ref:q})]}),(0,r.jsx)("div",{className:"px-6 py-4 border-t border-white/5 bg-[#121212]",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{className:"p-2 hover:bg-white/10 rounded-lg",children:(0,r.jsx)(o,{className:"w-5 h-5 text-gray-400"})}),(0,r.jsxs)("div",{className:"flex-1 bg-[#1a1a1a] rounded-full px-4 py-2 flex items-center",children:[(0,r.jsx)("input",{value:a,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O())},placeholder:"Write a message...",className:"flex-1 bg-transparent text-white outline-none"}),(0,r.jsx)("button",{disabled:!a.trim()||S,onClick:O,className:"ml-2 disabled:opacity-50",children:S?(0,r.jsx)(s.A,{className:"w-5 h-5 animate-spin text-blue-500"}):(0,r.jsx)(u.A,{className:"w-5 h-5 ".concat(a.trim()?"text-blue-500":"text-gray-500")})})]})]})})]}):(0,r.jsx)("div",{className:"flex-1 flex justify-center items-center text-gray-400",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(d.A,{className:"w-20 h-20 mx-auto mb-4 opacity-20"}),(0,r.jsx)("h3",{className:"text-white text-lg font-semibold",children:"Select a conversation"}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"Choose a conversation from the sidebar"})]})})]})}},47886:(e,t,a)=>{"use strict";a.d(t,{HW:()=>s,iD:()=>n});let r="http://127.0.0.1:8000";async function s(){try{let e=localStorage.getItem("auth_token");if(!e)return null;let t=await fetch("".concat(r,"/api/auth/me/"),{headers:{"Content-Type":"application/json",Authorization:"Token ".concat(e)}});if(!t.ok)return(401===t.status||403===t.status)&&localStorage.removeItem("auth_token"),null;return await t.json()}catch(e){return console.error("Error fetching current user:",e),null}}async function n(e){try{var t,a;let s=await fetch("".concat(r,"/api/auth/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();return{user:null,error:(null==(t=e.non_field_errors)?void 0:t[0])||e.detail||"Login failed"}}let n=await s.json();return n.token&&(a=n.token,localStorage.setItem("auth_token",a)),{user:n.user||null,error:null}}catch(e){return console.error("Login error:",e),{user:null,error:"An unexpected error occurred"}}}},71847:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(12115);let s=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:o="",children:u,iconNode:d,...h}=e;return(0,r.createElement)("svg",{ref:t,...n,width:i,height:i,stroke:a,strokeWidth:c?24*Number(l)/Number(i):l,className:s("lucide",o),...h},[...d.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(u)?u:[u]])}),l=(e,t)=>{let a=(0,r.forwardRef)((a,n)=>{let{className:l,...c}=a;return(0,r.createElement)(i,{ref:n,iconNode:t,className:s("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),l),...c})});return a.displayName="".concat(e),a}},72011:(e,t,a)=>{"use strict";a.d(t,{P:()=>i});let r="http://127.0.0.1:8000";function s(){return localStorage.getItem("auth_token")}class n{async request(e,t){let a=s();if(!a)throw Error("Not authenticated");let n=await fetch("".concat(r).concat(e),{...t,headers:{Authorization:"Token ".concat(a),...null==t?void 0:t.headers}});if(!n.ok){let e=await n.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||e.error||"Request failed")}return n.json()}async getConversations(e){let t=new URLSearchParams;return e&&"all"!==e&&t.append("type",e),this.request("/chat/api/conversations/".concat(t.toString()?"?".concat(t.toString()):""))}async getConversation(e){return this.request("/chat/api/conversations/".concat(e,"/"))}async getMessages(e){return this.request("/chat/api/conversations/".concat(e,"/messages/"))}async sendMessage(e,t,a){let n=s();if(!n)throw Error("Not authenticated");let i=new FormData;i.append("content",t),a&&i.append("image",a);let l=await fetch("".concat(r,"/chat/api/conversations/").concat(e,"/messages/"),{method:"POST",headers:{Authorization:"Token ".concat(n)},body:i});if(!l.ok)throw Error((await l.json().catch(()=>({detail:"Failed to send message"}))).detail||"Failed to send message");return l.json()}async startConversationWithUser(e){return this.request("/chat/api/start-conversation/user/".concat(e,"/"),{method:"POST"})}async startConversationWithBrand(e){return this.request("/chat/api/start-conversation/brand/".concat(e,"/"),{method:"POST"})}async getConversationStats(){return this.request("/chat/api/conversation-stats/")}createWebSocket(e){let t=s();if(!t)return null;let a="https:"===window.location.protocol?"wss:":"ws:",n=r.replace("http://","").replace("https://","");return new WebSocket("".concat(a,"//").concat(n,"/ws/conversation/").concat(e,"/?token=").concat(t))}}let i=new n},86651:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},96583:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])}},e=>{e.O(0,[8720,8441,1255,7358],()=>e(e.s=26869)),_N_E=e.O()}]);