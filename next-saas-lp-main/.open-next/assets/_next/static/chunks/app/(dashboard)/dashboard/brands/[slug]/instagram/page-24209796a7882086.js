(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4031],{20063:(e,s,t)=>{"use strict";var a=t(47260);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},35626:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(71847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},94210:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>v});var a=t(95155),r=t(12115),l=t(20063),n=t(52619),d=t.n(n),i=t(35626),c=t(42529),o=t(6191),u=t(6132),m=t(16485),h=t(11010),x=t(85921),g=t(71360),p=t(93499),b=t(67161),f=t(93449),j=t(84335),N=t(56514),w=t(18720);function v(){var e;let s=(0,l.useParams)(),t=(0,l.useRouter)(),n=null==s?void 0:s.slug,[v,y]=(0,r.useState)(null),[k,C]=(0,r.useState)(!0),[_,P]=(0,r.useState)(!1),[R,A]=(0,r.useState)(!1),[S,E]=(0,r.useState)(null),[F,I]=(0,r.useState)({caption:"",image:"",scheduled_time:""}),U=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=!0,s=async()=>{C(!0);try{let s=(await j.v.getBrands()).find(e=>e.slug===n);if(!s)return void t.push("/dashboard/brands");e&&y(s)}catch(e){console.error("Failed to load brand:",e),w.oR.error("Failed to load brand"),t.push("/dashboard/brands")}finally{e&&C(!1)}};return n?s():C(!1),()=>{e=!1}},[n,t]);let{account:L,isConnecting:z,connect:q,disconnect:B,refetch:D}=(0,f.er)(null!=(e=null==v?void 0:v.id)?e:void 0),{posts:G=[],isLoading:H,createPost:M,updatePost:O,deletePost:T,postNow:V,refetch:Y}=(0,f.jC)(null==v?void 0:v.id);(0,r.useEffect)(()=>{if("true"===new URLSearchParams(window.location.search).get("refresh")){let e=window.location.pathname;window.history.replaceState({},"",e),setTimeout(()=>{try{null==D||D(),null==Y||Y()}catch(e){console.warn("Error refetching after refresh param:",e)}},400)}},[D,Y]);let J=(0,r.useCallback)(()=>{I({caption:"",image:"",scheduled_time:""}),E(null),P(!1),A(!1)},[]),K=(0,r.useCallback)(async()=>{if(!F.caption.trim())return void w.oR.error("Caption required");if(!F.image)return void w.oR.error("Select an image");if(!(null==v?void 0:v.id))return void w.oR.error("Brand not selected");try{let e={caption:F.caption,imageUrl:F.image,brand_id:v.id,scheduled_time:F.scheduled_time||void 0};await M(e),w.oR.success("Post created"),null==Y||Y(),J()}catch(e){console.error("Create post failed:",e),w.oR.error("Failed to create post")}},[F,null==v?void 0:v.id,M,Y,J]),Q=(0,r.useCallback)(async()=>{if(S)try{await O(S.id,{caption:F.caption,imageUrl:F.image,scheduled_time:F.scheduled_time||void 0}),w.oR.success("Post updated"),null==Y||Y(),J()}catch(e){console.error("Update post failed:",e),w.oR.error("Failed to update post")}},[S,F,O,Y,J]),W=(0,r.useCallback)(async e=>{try{await T(e),w.oR.success("Post deleted"),null==Y||Y()}catch(e){console.error("Delete failed:",e),w.oR.error("Failed to delete post")}},[T,Y]),X=(0,r.useCallback)(async e=>{try{await V(e),w.oR.success("Posted to Instagram"),null==Y||Y()}catch(e){console.error("Post now failed:",e),w.oR.error("Failed to post now")}},[V,Y]);(0,r.useEffect)(()=>{if(!_)return;let e=e=>{U.current&&!U.current.contains(e.target)&&J()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[_,J]);let Z={posted:"text-green-400 bg-green-500/20",approved:"text-blue-400 bg-blue-500/20",scheduled:"text-blue-400 bg-blue-500/20",draft:"text-gray-400 bg-gray-500/20",failed:"text-red-400 bg-red-500/20",default:"text-gray-400 bg-gray-500/20"};return k?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-black",children:(0,a.jsx)("div",{className:"animate-spin h-8 w-8 rounded-full border-b-2 border-purple-500"})}):v?(0,a.jsxs)("div",{className:"min-h-screen bg-black text-white p-8 relative",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(d(),{href:"/dashboard/brands",className:"p-2 hover:bg-white/10 rounded-lg",children:(0,a.jsx)(i.A,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center rounded-lg font-bold",children:v.name.substring(0,2)}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:[v.name," – Instagram"]}),(0,a.jsxs)("p",{className:"text-gray-400",children:[v.organization_name&&v.organization_name+" • ","Instagram Management"]})]})]}),(0,a.jsx)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 flex items-center justify-between",children:(null==L?void 0:L.connected)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-green-500/20 p-2 rounded-lg",children:(0,a.jsx)(c.A,{className:"text-green-400 w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Instagram Connected"}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:["@",L.instagram_username]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg",onClick:()=>P(!0),children:[(0,a.jsx)(o.A,{className:"w-4 h-4 inline-block"})," Create"]}),(0,a.jsx)("button",{onClick:()=>B().catch(e=>{console.error("Disconnect error:",e),w.oR.error("Failed to disconnect")}),className:"px-4 py-2 rounded-lg bg-red-600/20 text-red-400 border border-red-600/30",children:"Disconnect"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Instagram Not Connected"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Connect to enable posting"})]})]}),(0,a.jsx)("button",{disabled:z,onClick:()=>q().catch(e=>{console.error("Connect err:",e),w.oR.error("Failed to connect")}),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg disabled:opacity-60",children:z?"Connecting...":"Connect"})]})})]}),(null==L?void 0:L.connected)&&(0,a.jsxs)("div",{className:"space-y-6 mt-10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Posts"}),(0,a.jsxs)("button",{onClick:()=>P(!0),className:"px-4 py-2 rounded-lg bg-purple-600",children:[(0,a.jsx)(o.A,{className:"w-4 h-4 inline-block"})," New Post"]})]}),H?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 opacity-70",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-60 bg-white/5 animate-pulse rounded-lg"},e))}):G.length?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(e=>{var s,t,r,l,n;return(0,a.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"aspect-square relative",children:[(0,a.jsx)("img",{src:e.image,alt:"post image",className:"w-full h-full object-cover"}),(0,a.jsx)("span",{className:"absolute top-2 right-2 px-2 py-1 text-xs rounded-full ".concat(Z[null!=(s=e.status)?s:""]||Z.default),children:null!=(t=e.status)?t:"unknown"})]}),(0,a.jsxs)("div",{className:"p-4 space-y-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-300 line-clamp-3",children:null!=(l=null!=(r=e.content)?r:e.caption)?l:""}),(e.scheduled_for||e.scheduled_time)&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 flex gap-2",children:[(0,a.jsx)(m.A,{className:"w-3 h-3"}),(e=>{if(!e)return"";let s=new Date(e);return Number.isNaN(s.getTime())?e:s.toLocaleString()})(null!=(n=e.scheduled_for)?n:e.scheduled_time)]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{var s,t,a,r,l;E(e),I({caption:null!=(t=null!=(s=e.content)?s:e.caption)?t:"",image:null!=(a=e.image)?a:"",scheduled_time:null!=(l=null!=(r=e.scheduled_for)?r:e.scheduled_time)?l:""}),P(!0),A(!1)},className:"flex-1 bg-white/5 hover:bg-white/10 px-3 py-2 rounded text-xs",children:[(0,a.jsx)(h.A,{className:"w-3 h-3 inline-block"})," Edit"]}),("approved"===e.status||"scheduled"===e.status)&&(0,a.jsxs)("button",{onClick:()=>X(e.id),className:"flex-1 bg-green-500/20 hover:bg-green-500/30 text-green-400 px-3 py-2 rounded text-xs",children:[(0,a.jsx)(x.A,{className:"w-3 h-3 inline-block"})," Post Now"]}),(0,a.jsx)("button",{onClick:()=>W(e.id),className:"bg-red-500/20 hover:bg-red-500/30 text-red-400 px-3 py-2 rounded text-xs",children:(0,a.jsx)(g.A,{className:"w-3 h-3 inline-block"})})]}),e.instagram_url&&(0,a.jsxs)("a",{href:e.instagram_url,target:"_blank",rel:"noreferrer",className:"text-xs text-purple-400 flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"w-3 h-3"})," View on Instagram"]})]})]},e.id)})}):(0,a.jsxs)("div",{className:"p-16 bg-white/5 rounded-lg border border-white/10 text-center",children:[(0,a.jsx)(b.A,{className:"w-10 h-10 mx-auto text-gray-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-bold",children:"No Posts Yet"}),(0,a.jsx)("p",{className:"text-gray-400 mt-2",children:"Create your first post!"}),(0,a.jsx)("button",{onClick:()=>P(!0),className:"mt-5 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg",children:"Create Post"})]})]}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[999] p-4",children:(0,a.jsxs)("div",{ref:U,className:"w-full max-w-lg bg-gray-900 border border-white/10 rounded-2xl p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:S?"Edit Post":"Create Post"}),(0,a.jsx)("button",{onClick:J,className:"text-gray-400 hover:text-white",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Image"}),F.image?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:F.image,className:"rounded-lg border border-white/10 w-full aspect-square object-cover",alt:"selected"}),(0,a.jsx)("button",{onClick:()=>I(e=>({...e,image:""})),className:"absolute top-2 right-2 bg-red-600 p-2 rounded-full",children:(0,a.jsx)(g.A,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(N.a,{currentImage:"",onImageUpload:e=>I(s=>({...s,image:e})),className:"aspect-square"}),(0,a.jsx)("button",{className:"w-full py-2 rounded-lg bg-white/5 border border-white/10 text-sm",onClick:()=>A(e=>!e),type:"button",children:R?"Hide Gallery":"Choose from Gallery"}),R&&(0,a.jsx)("div",{className:"border border-white/10 rounded-lg p-3",children:(0,a.jsx)(N.i,{selectedImage:F.image,onImageSelect:e=>{I(s=>({...s,image:e})),A(!1)},showUpload:!1})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Caption"}),(0,a.jsx)("textarea",{className:"w-full bg-white/5 border border-white/10 rounded-lg p-3 h-28 resize-none",value:F.caption,onChange:e=>I(s=>({...s,caption:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Schedule (optional)"}),(0,a.jsx)("input",{type:"datetime-local",className:"w-full bg-white/5 border border-white/10 rounded-lg p-3",value:F.scheduled_time,onChange:e=>I(s=>({...s,scheduled_time:e.target.value}))})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-3",children:[(0,a.jsx)("button",{className:"flex-1 py-2 border border-white/10 rounded-lg bg-white/5",onClick:J,children:"Cancel"}),(0,a.jsx)("button",{className:"flex-1 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 disabled:opacity-50",disabled:!F.caption||!F.image,onClick:S?Q:K,children:S?"Update":"Create"})]})]})]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-black text-white p-8",children:(0,a.jsxs)("div",{className:"max-w-xl mx-auto text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Brand Not Found"}),(0,a.jsxs)(d(),{href:"/dashboard/brands",className:"px-6 py-3 bg-purple-600 rounded-lg flex items-center gap-2 mx-auto w-fit",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"})," Back"]})]})})}},98040:(e,s,t)=>{Promise.resolve().then(t.bind(t,94210))}},e=>{e.O(0,[297,8720,3864,8441,1255,7358],()=>e(e.s=98040)),_N_E=e.O()}]);